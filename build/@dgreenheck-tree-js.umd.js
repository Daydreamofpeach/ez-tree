(function(u,p){typeof exports=="object"&&typeof module<"u"?p(exports,require("three")):typeof define=="function"&&define.amd?define(["exports","three"],p):(u=typeof globalThis<"u"?globalThis:u||self,p(u["@dgreenheck-tree-js"]={},u.THREE))})(this,function(u,p){"use strict";var D=Object.defineProperty;var G=(u,p,b)=>p in u?D(u,p,{enumerable:!0,configurable:!0,writable:!0,value:b}):u[p]=b;var v=(u,p,b)=>(G(u,typeof p!="symbol"?p+"":p,b),b);var b=typeof document<"u"?document.currentScript:null;function F(m){const g=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(m){for(const e in m)if(e!=="default"){const s=Object.getOwnPropertyDescriptor(m,e);Object.defineProperty(g,e,s.get?s:{enumerable:!0,get:()=>m[e]})}}return g.default=m,Object.freeze(g)}const t=F(p);class z{constructor(g){v(this,"m_w",123456789);v(this,"m_z",987654321);v(this,"mask",4294967295);this.m_w=123456789+g&this.mask,this.m_z=987654321-g&this.mask}random(g=1,e=0){this.m_z=36969*(this.m_z&65535)+(this.m_z>>16)&this.mask,this.m_w=18e3*(this.m_w&65535)+(this.m_w>>16)&this.mask;let s=(this.m_z<<16)+(this.m_w&65535)>>>0;return s/=4294967296,(g-e)*s+e}}class E{constructor(g=new t.Vector3,e=new t.Euler,s=0,r=0,c=0,l=0,h=0){this.origin=g.clone(),this.orientation=e.clone(),this.length=s,this.radius=r,this.level=c,this.sectionCount=l,this.segmentCount=h}}const O={Birch:"birch",Oak:"oak",Pine:"pine",Willow:"willow"},V={Single:"single",Double:"double"},T={Ash:"ash",Aspen:"aspen",Beech:"beech",Evergreen:"evergreen",Oak:"oak"},x={Deciduous:"deciduous",Evergreen:"evergreen"},Q={seed:0,type:x.Deciduous,tint:16777215,flatShading:!1,textured:!0,levels:3,bark:{type:"oak",scale:1},branch:{angle:{1:60,2:60,3:60},children:{0:7,1:4,2:4},force:{direction:{x:0,y:1,z:0},strength:.01},gnarliness:{0:.2,1:.2,2:.05,3:.02},length:{0:20,1:15,2:5,3:1},radius:{0:.7,1:.7,2:.7,3:.7},sections:{0:12,1:10,2:8,3:6},segments:{0:8,1:6,2:4,3:3},start:{1:.5,2:.3,3:.3},taper:{0:.7,1:.7,2:.7,3:.7},twist:{0:0,1:0,2:0,3:0}},leaves:{type:T.Oak,billboard:V.Double,angle:30,count:3,start:0,size:1.75,sizeVariance:.7,tint:16777215,alphaTest:.5}},j={birch:{ao:"../src/textures/bark/birch_ao_1k.jpg",color:"../src/textures/bark/birch_color_1k.jpg",height:"../src/textures/bark/birch_height_1k.jpg",normal:"../src/textures/bark/birch_normal_1k.jpg",roughness:"../src/textures/bark/birch_roughness_1k.jpg"},oak:{ao:"../src/textures/bark/oak_ao_1k.jpg",color:"../src/textures/bark/oak_color_1k.jpg",height:"../src/textures/bark/oak_height_1k.jpg",normal:"../src/textures/bark/oak_normal_1k.jpg",roughness:"../src/textures/bark/oak_roughness_1k.jpg"},pine:{ao:"../src/textures/bark/pine_ao_1k.jpg",color:"../src/textures/bark/pine_color_1k.jpg",height:"../src/textures/bark/pine_height_1k.jpg",normal:"../src/textures/bark/pine_normal_1k.jpg",roughness:"../src/textures/bark/pine_roughness_1k.jpg"},willow:{ao:"../src/textures/bark/willow_ao_1k.jpg",color:"../src/textures/bark/willow_color_1k.jpg",height:"../src/textures/bark/willow_height_1k.jpg",normal:"../src/textures/bark/willow_normal_1k.jpg",roughness:"../src/textures/bark/willow_roughness_1k.jpg"}},C={ash:"../src/textures/leaves/ash.png",aspen:"../src/textures/leaves/aspen.png",beech:"../src/textures/leaves/beech.png",evergreen:"../src/textures/leaves/evergreen.png",oak:"../src/textures/leaves/oak.png"},S={},L=new t.TextureLoader,_=(m,g=new t.Vector2(1,1))=>{if(S[m]){const e=S[m];return e.wrapS=t.MirroredRepeatWrapping,e.wrapT=t.MirroredRepeatWrapping,e}else{const e=new URL(m,typeof document>"u"&&typeof location>"u"?require("url").pathToFileURL(__filename).href:typeof document>"u"?location.href:b&&b.src||new URL("@dgreenheck-tree-js.umd.js",document.baseURI).href).href,s=L.load(e);return S[m]=s,s}};class q extends t.Group{constructor(e=Q){super();v(this,"rng");v(this,"params");v(this,"branchQueue",[]);this.params=e,this.branchesMesh=new t.Mesh,this.leavesMesh=new t.Mesh,this.add(this.branchesMesh),this.add(this.leavesMesh)}async generate(){for(this.branches={verts:[],normals:[],indices:[],uvs:[]},this.leaves={verts:[],normals:[],indices:[],uvs:[]},this.rng=new z(this.params.seed),this.branchQueue.push(new E(new t.Vector3,new t.Euler,this.params.branch.length[0],this.params.branch.radius[0],0,this.params.branch.sections[0],this.params.branch.segments[0]));this.branchQueue.length>0;){const e=this.branchQueue.shift();this.generateBranch(e)}this.createBranchesGeometry(),this.createLeavesGeometry()}generateBranch(e){const s=this.branches.verts.length/3;let r=e.orientation.clone(),c=e.origin.clone(),l=e.length/e.sectionCount/(this.params.type==="Deciduous"?this.params.levels-1:1),h=[];for(let a=0;a<=e.sectionCount;a++){let o=e.radius;a===e.sectionCount&&e.level===this.params.levels?o=.001:this.params.type===x.Deciduous?o*=1-this.params.branch.taper[e.level]*(a/e.sectionCount):this.params.type===x.Evergreen&&(o*=1-a/e.sectionCount);let n;for(let f=0;f<e.segmentCount;f++){let w=2*Math.PI*f/e.segmentCount;const k=new t.Vector3(Math.cos(w),0,Math.sin(w)).multiplyScalar(o).applyEuler(r).add(c),y=new t.Vector3(Math.cos(w),0,Math.sin(w)).applyEuler(r).normalize(),B=new t.Vector2(f/e.segmentCount,a%2===0?0:1);this.branches.verts.push(...Object.values(k)),this.branches.normals.push(...Object.values(y)),this.branches.uvs.push(...Object.values(B)),f===0&&(n={vertex:k,normal:y,uv:B})}this.branches.verts.push(...Object.values(n.vertex)),this.branches.normals.push(...Object.values(n.normal)),this.branches.uvs.push(1,n.uv.y),h.push({origin:c.clone(),orientation:r.clone(),radius:o}),c.add(new t.Vector3(0,l,0).applyEuler(r));const i=Math.max(1,1/Math.sqrt(o))*this.params.branch.gnarliness[e.level];r.x+=this.rng.random(i,-i),r.z+=this.rng.random(i,-i);const d=new t.Quaternion().setFromEuler(r),M=new t.Quaternion().setFromAxisAngle(new t.Vector3(0,1,0),this.params.branch.twist[e.level]),A=new t.Quaternion().setFromUnitVectors(new t.Vector3(0,1,0),new t.Vector3().copy(this.params.branch.force.direction));d.multiply(M),d.rotateTowards(A,this.params.branch.force.strength/o),r.setFromQuaternion(d)}if(this.generateBranchIndices(s,e),this.params.type==="deciduous"){const a=h[h.length-1];e.level<this.params.levels?this.branchQueue.push(new E(a.origin,a.orientation,this.params.branch.length[e.level+1]/2,a.radius,e.level+1,e.sectionCount,e.segmentCount)):this.generateLeaf(a.origin,a.orientation)}e.level===this.params.levels?this.generateLeaves(h):e.level<this.params.levels&&this.generateChildBranches(this.params.branch.children[e.level],e.level+1,h)}generateChildBranches(e,s,r){const c=this.rng.random();for(let l=0;l<e;l++){let h=this.rng.random(1,this.params.branch.start[s]);const a=Math.floor(h*(r.length-1));let o,n;o=r[a],a===r.length-1?n=o:n=r[a+1];const i=(h-a/(r.length-1))/(1/(r.length-1)),d=new t.Vector3().lerpVectors(o.origin,n.origin,i),M=this.params.branch.radius[s]*((1-i)*o.radius+i*n.radius),A=new t.Quaternion().setFromEuler(o.orientation),f=new t.Quaternion().setFromEuler(n.orientation),w=new t.Euler().setFromQuaternion(f.slerp(A,i)),k=2*Math.PI*(c+l/e),y=new t.Quaternion().setFromAxisAngle(new t.Vector3(1,0,0),this.params.branch.angle[s]/(180/Math.PI)),B=new t.Quaternion().setFromAxisAngle(new t.Vector3(0,1,0),k),I=new t.Quaternion().setFromEuler(w),P=new t.Euler().setFromQuaternion(I.multiply(B.multiply(y)));let R=this.params.branch.length[s]*(this.params.type===x.Evergreen?1-h:1);this.branchQueue.push(new E(d,P,R,M,s,this.params.branch.sections[s],this.params.branch.segments[s]))}}generateLeaves(e){const s=this.rng.random();for(let r=0;r<this.params.leaves.count;r++){let c=this.rng.random(1,this.params.leaves.start);const l=Math.floor(c*(e.length-1));let h,a;h=e[l],l===e.length-1?a=h:a=e[l+1];const o=(c-l/(e.length-1))/(1/(e.length-1)),n=new t.Vector3().lerpVectors(h.origin,a.origin,o),i=new t.Quaternion().setFromEuler(h.orientation),d=new t.Quaternion().setFromEuler(a.orientation),M=new t.Euler().setFromQuaternion(d.slerp(i,o)),A=2*Math.PI*(s+r/this.params.leaves.count),f=new t.Quaternion().setFromAxisAngle(new t.Vector3(1,0,0),this.params.leaves.angle/(180/Math.PI)),w=new t.Quaternion().setFromAxisAngle(new t.Vector3(0,1,0),A),k=new t.Quaternion().setFromEuler(M),y=new t.Euler().setFromQuaternion(k.multiply(w.multiply(f)));this.generateLeaf(n,y)}}generateLeaf(e,s){let r=this.leaves.verts.length/3,c=this.params.leaves.size*(1+this.rng.random(this.params.leaves.sizeVariance,-this.params.leaves.sizeVariance));const l=c,h=1.5*c,a=o=>{const n=[new t.Vector3(-l/2,h,0),new t.Vector3(-l/2,0,0),new t.Vector3(l/2,0,0),new t.Vector3(l/2,h,0)].map(d=>d.applyEuler(new t.Euler(0,o,0)).applyEuler(s).add(e));this.leaves.verts.push(n[0].x,n[0].y,n[0].z,n[1].x,n[1].y,n[1].z,n[2].x,n[2].y,n[2].z,n[3].x,n[3].y,n[3].z);const i=new t.Vector3(0,0,1).applyEuler(s);this.leaves.normals.push(i.x,i.y,i.z,i.x,i.y,i.z,i.x,i.y,i.z,i.x,i.y,i.z),this.leaves.uvs.push(0,1,0,0,1,0,1,1),this.leaves.indices.push(r,r+1,r+2,r,r+2,r+3),r+=4};a(0),this.params.leaves.billboard===V.Double&&a(Math.PI/2)}generateBranchIndices(e,s){let r,c,l,h;const a=s.segmentCount+1;for(let o=0;o<s.sectionCount;o++)for(let n=0;n<s.segmentCount;n++)r=e+o*a+n,c=e+o*a+(n+1),l=r+a,h=c+a,this.branches.indices.push(r,l,c,c,l,h)}createBranchesGeometry(){const e=new t.BufferGeometry;e.setAttribute("position",new t.BufferAttribute(new Float32Array(this.branches.verts),3)),e.setAttribute("normal",new t.BufferAttribute(new Float32Array(this.branches.normals),3)),e.setAttribute("uv",new t.BufferAttribute(new Float32Array(this.branches.uvs),2)),e.setIndex(new t.BufferAttribute(new Uint16Array(this.branches.indices),1)),e.computeBoundingSphere();const s=new t.MeshStandardMaterial({name:"branches",flatShading:this.params.flatShading,color:this.params.tint});this.branchesMesh.geometry.dispose(),this.branchesMesh.geometry=e,this.branchesMesh.material.dispose(),this.branchesMesh.material=s,this.branchesMesh.castShadow=!0,this.branchesMesh.receiveShadow=!0,this.params.textured&&(this.branchesMesh.material.aoMap=_(j[this.params.bark.type].ao,this.params.bark.scale),this.branchesMesh.material.map=_(j[this.params.bark.type].color,this.params.bark.scale),this.branchesMesh.material.normalMap=_(j[this.params.bark.type].normal,this.params.bark.scale),this.branchesMesh.material.roughnessMap=_(j[this.params.bark.type].roughness,this.params.bark.scale))}createLeavesGeometry(){const e=new t.BufferGeometry;e.setAttribute("position",new t.BufferAttribute(new Float32Array(this.leaves.verts),3)),e.setAttribute("uv",new t.BufferAttribute(new Float32Array(this.leaves.uvs),2)),e.setIndex(new t.BufferAttribute(new Uint16Array(this.leaves.indices),1)),e.computeVertexNormals(),e.computeBoundingSphere();const s=new t.MeshStandardMaterial({name:"leaves",color:this.params.leaves.tint,side:t.DoubleSide,alphaTest:this.params.leaves.alphaTest});this.leavesMesh.geometry.dispose(),this.leavesMesh.geometry=e,this.leavesMesh.material.dispose(),this.leavesMesh.material=s,this.leavesMesh.material.map=_(C[this.params.leaves.type]),this.leavesMesh.castShadow=!0,this.leavesMesh.receiveShadow=!0}}u.BarkType=O,u.Billboard=V,u.LeafType=T,u.Tree=q,u.TreeType=x,Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQGRncmVlbmhlY2stdHJlZS1qcy51bWQuanMiLCJzb3VyY2VzIjpbIi4uL3NyYy9ybmcuanMiLCIuLi9zcmMvYnJhbmNoLmpzIiwiLi4vc3JjL2VudW1zLmpzIiwiLi4vc3JjL3RyZWVQYXJhbXMuanMiLCIuLi9zcmMvdHJlZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZGVmYXVsdCBjbGFzcyBSTkcge1xuICBtX3cgPSAxMjM0NTY3ODk7XG4gIG1feiA9IDk4NzY1NDMyMTtcbiAgbWFzayA9IDB4ZmZmZmZmZmY7XG5cbiAgY29uc3RydWN0b3Ioc2VlZCkge1xuICAgIHRoaXMubV93ID0gKDEyMzQ1Njc4OSArIHNlZWQpICYgdGhpcy5tYXNrO1xuICAgIHRoaXMubV96ID0gKDk4NzY1NDMyMSAtIHNlZWQpICYgdGhpcy5tYXNrO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgYSByYW5kb20gbnVtYmVyIGJldHdlZW4gbWluIGFuZCBtYXhcbiAgICovXG4gIHJhbmRvbShtYXggPSAxLCBtaW4gPSAwKSB7XG4gICAgdGhpcy5tX3ogPSAoMzY5NjkgKiAodGhpcy5tX3ogJiA2NTUzNSkgKyAodGhpcy5tX3ogPj4gMTYpKSAmIHRoaXMubWFzaztcbiAgICB0aGlzLm1fdyA9ICgxODAwMCAqICh0aGlzLm1fdyAmIDY1NTM1KSArICh0aGlzLm1fdyA+PiAxNikpICYgdGhpcy5tYXNrO1xuICAgIGxldCByZXN1bHQgPSAoKHRoaXMubV96IDw8IDE2KSArICh0aGlzLm1fdyAmIDY1NTM1KSkgPj4+IDA7XG4gICAgcmVzdWx0IC89IDQyOTQ5NjcyOTY7XG5cbiAgICByZXR1cm4gKG1heCAtIG1pbikgKiByZXN1bHQgKyBtaW47XG4gIH1cbn1cbiIsImltcG9ydCAqIGFzIFRIUkVFIGZyb20gJ3RocmVlJztcblxuZXhwb3J0IGNsYXNzIEJyYW5jaCB7XG4gIC8qKlxuICAgKiBHZW5lcmF0ZXMgYSBuZXcgYnJhbmNoXG4gICAqIEBwYXJhbSB7VEhSRUUuVmVjdG9yM30gb3JpZ2luIFRoZSBzdGFydGluZyBwb2ludCBvZiB0aGUgYnJhbmNoXG4gICAqIEBwYXJhbSB7VEhSRUUuRXVsZXJ9IG9yaWVudGF0aW9uIFRoZSBzdGFydGluZyBvcmllbnRhdGlvbiBvZiB0aGUgYnJhbmNoXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBsZW5ndGggVGhlIGxlbmd0aCBvZiB0aGUgYnJhbmNoXG4gICAqIEBwYXJhbSB7bnVtYmVyfSByYWRpdXMgVGhlIHJhZGl1cyBvZiB0aGUgYnJhbmNoIGF0IGl0cyBzdGFydGluZyBwb2ludFxuICAgKi9cbiAgY29uc3RydWN0b3IoXG4gICAgb3JpZ2luID0gbmV3IFRIUkVFLlZlY3RvcjMoKSxcbiAgICBvcmllbnRhdGlvbiA9IG5ldyBUSFJFRS5FdWxlcigpLFxuICAgIGxlbmd0aCA9IDAsXG4gICAgcmFkaXVzID0gMCxcbiAgICBsZXZlbCA9IDAsXG4gICAgc2VjdGlvbkNvdW50ID0gMCxcbiAgICBzZWdtZW50Q291bnQgPSAwLFxuICApIHtcbiAgICB0aGlzLm9yaWdpbiA9IG9yaWdpbi5jbG9uZSgpO1xuICAgIHRoaXMub3JpZW50YXRpb24gPSBvcmllbnRhdGlvbi5jbG9uZSgpO1xuICAgIHRoaXMubGVuZ3RoID0gbGVuZ3RoO1xuICAgIHRoaXMucmFkaXVzID0gcmFkaXVzO1xuICAgIHRoaXMubGV2ZWwgPSBsZXZlbDtcbiAgICB0aGlzLnNlY3Rpb25Db3VudCA9IHNlY3Rpb25Db3VudDtcbiAgICB0aGlzLnNlZ21lbnRDb3VudCA9IHNlZ21lbnRDb3VudDtcbiAgfVxufVxuIiwiZXhwb3J0IGNvbnN0IEJhcmtUeXBlID0ge1xuICBCaXJjaDogJ2JpcmNoJyxcbiAgT2FrOiAnb2FrJyxcbiAgUGluZTogJ3BpbmUnLFxuICBXaWxsb3c6ICd3aWxsb3cnXG59O1xuXG5leHBvcnQgY29uc3QgQmlsbGJvYXJkID0ge1xuICBTaW5nbGU6ICdzaW5nbGUnLFxuICBEb3VibGU6ICdkb3VibGUnLFxufTtcblxuZXhwb3J0IGNvbnN0IExlYWZUeXBlID0ge1xuICBBc2g6ICdhc2gnLFxuICBBc3BlbjogJ2FzcGVuJyxcbiAgQmVlY2g6ICdiZWVjaCcsXG4gIEV2ZXJncmVlbjogJ2V2ZXJncmVlbicsXG4gIE9hazogJ29haycsXG59O1xuXG5leHBvcnQgY29uc3QgVHJlZVR5cGUgPSB7XG4gIERlY2lkdW91czogJ2RlY2lkdW91cycsXG4gIEV2ZXJncmVlbjogJ2V2ZXJncmVlbicsXG59OyIsImltcG9ydCB7IEJpbGxib2FyZCwgTGVhZlR5cGUsIFRyZWVUeXBlIH0gZnJvbSAnLi9lbnVtcydcblxuZXhwb3J0IGNvbnN0IFRyZWVQYXJhbXMgPSB7XG4gIHNlZWQ6IDAsXG4gIHR5cGU6IFRyZWVUeXBlLkRlY2lkdW91cyxcblxuICAvLyBUaW50IG9mIHRoZSB0cmVlIHRydW5rXG4gIHRpbnQ6IDB4ZmZmZmZmLFxuXG4gIC8vIFVzZSBmYWNlIG5vcm1hbHMgZm9yIHNoYWRpbmcgaW5zdGVhZCBvZiB2ZXJ0ZXggbm9ybWFsc1xuICBmbGF0U2hhZGluZzogZmFsc2UsXG5cbiAgLy8gQXBwbHkgdGV4dHVyZSB0byBiYXJrXG4gIHRleHR1cmVkOiB0cnVlLFxuXG4gIC8vIE51bWJlciBvZiBicmFuY2ggcmVjdXJzaW9uIGxldmVscy4gMCA9IHRydW5rIG9ubHlcbiAgbGV2ZWxzOiAzLFxuXG4gIC8vIEJhcmsgcGFyYW1ldGVyc1xuICBiYXJrOiB7XG4gICAgLy8gVGhlIGJhcmsgdGV4dHVyZVxuICAgIHR5cGU6ICdvYWsnLFxuXG4gICAgLy8gVGV4dHVyZSBzY2FsZVxuICAgIHNjYWxlOiAxXG4gIH0sXG5cbiAgLy8gQnJhbmNoIHBhcmFtZXRlcnNcbiAgYnJhbmNoOiB7XG5cbiAgICAvLyBBbmdsZSBvZiB0aGUgY2hpbGQgYnJhbmNoZXMgcmVsYXRpdmUgdG8gdGhlIHBhcmVudCBicmFuY2ggKGRlZ3JlZXMpXG4gICAgYW5nbGU6IHtcbiAgICAgIDE6IDYwLFxuICAgICAgMjogNjAsXG4gICAgICAzOiA2MFxuICAgIH0sXG5cbiAgICAvLyBOdW1iZXIgb2YgY2hpbGRyZW4gcGVyIGJyYW5jaCBsZXZlbFxuICAgIGNoaWxkcmVuOiB7XG4gICAgICAwOiA3LFxuICAgICAgMTogNCxcbiAgICAgIDI6IDRcbiAgICB9LFxuXG4gICAgLy8gRXh0ZXJuYWwgZm9yY2UgZW5jb3VyYWdpbmcgdHJlZSBncm93dGggaW4gYSBwYXJ0aWN1bGFyIGRpcmVjdGlvblxuICAgIGZvcmNlOiB7XG4gICAgICBkaXJlY3Rpb246IHsgeDogMCwgeTogMSwgejogMCB9LFxuICAgICAgc3RyZW5ndGg6IDAuMDEsXG4gICAgfSxcblxuICAgIC8vIEFtb3VudCBvZiBjdXJsaW5nL3R3aXN0aW5nICBhdCBlYWNoIGJyYW5jaCBsZXZlbFxuICAgIGduYXJsaW5lc3M6IHtcbiAgICAgIDA6IDAuMixcbiAgICAgIDE6IDAuMixcbiAgICAgIDI6IDAuMDUsXG4gICAgICAzOiAwLjAyLFxuICAgIH0sXG5cbiAgICAvLyBMZW5ndGggb2YgZWFjaCBicmFuY2ggbGV2ZWxcbiAgICBsZW5ndGg6IHtcbiAgICAgIDA6IDIwLFxuICAgICAgMTogMTUsXG4gICAgICAyOiA1LFxuICAgICAgMzogMVxuICAgIH0sXG5cbiAgICAvLyBSYWRpdXMgb2YgZWFjaCBicmFuY2ggbGV2ZWxcbiAgICByYWRpdXM6IHtcbiAgICAgIDA6IDAuNyxcbiAgICAgIDE6IDAuNyxcbiAgICAgIDI6IDAuNyxcbiAgICAgIDM6IDAuN1xuICAgIH0sXG5cbiAgICAvLyBOdW1iZXIgb2Ygc2VjdGlvbnMgcGVyIGJyYW5jaCBsZXZlbFxuICAgIHNlY3Rpb25zOiB7XG4gICAgICAwOiAxMixcbiAgICAgIDE6IDEwLFxuICAgICAgMjogOCxcbiAgICAgIDM6IDYsXG4gICAgfSxcblxuICAgIC8vIE51bWJlciBvZiByYWRpYWwgc2VnbWVudHMgcGVyIGJyYW5jaCBsZXZlbFxuICAgIHNlZ21lbnRzOiB7XG4gICAgICAwOiA4LFxuICAgICAgMTogNixcbiAgICAgIDI6IDQsXG4gICAgICAzOiAzLFxuICAgIH0sXG5cbiAgICAvLyBEZWZpbmVzIHdoZXJlIGNoaWxkIGJyYW5jaGVzIHN0YXJ0IGZvcm1pbmcgb24gdGhlIHBhcmVudCBicmFuY2hcbiAgICBzdGFydDoge1xuICAgICAgMTogMC41LFxuICAgICAgMjogMC4zLFxuICAgICAgMzogMC4zXG4gICAgfSxcblxuICAgIC8vIFRhcGVyIGF0IGVhY2ggYnJhbmNoIGxldmVsXG4gICAgdGFwZXI6IHtcbiAgICAgIDA6IDAuNyxcbiAgICAgIDE6IDAuNyxcbiAgICAgIDI6IDAuNyxcbiAgICAgIDM6IDAuNyxcbiAgICB9LFxuXG4gICAgLy8gQW1vdW50IG9mIHR3aXN0IGF0IGVhY2ggYnJhbmNoIGxldmVsXG4gICAgdHdpc3Q6IHtcbiAgICAgIDA6IDAsXG4gICAgICAxOiAwLFxuICAgICAgMjogMCxcbiAgICAgIDM6IDAsXG4gICAgfSxcbiAgfSxcblxuICAvLyBMZWFmIHBhcmFtZXRlcnNcbiAgbGVhdmVzOiB7XG4gICAgLy8gTGVhZiB0ZXh0dXJlIHRvIHVzZVxuICAgIHR5cGU6IExlYWZUeXBlLk9hayxcblxuICAgIC8vIFdoZXRoZXIgdG8gdXNlIHNpbmdsZSBvciBkb3VibGUvcGVycGVuZGljdWxhciBiaWxsYm9hcmRzXG4gICAgYmlsbGJvYXJkOiBCaWxsYm9hcmQuRG91YmxlLFxuXG4gICAgLy8gQW5nbGUgb2YgbGVhdmVzIHJlbGF0aXZlIHRvIHBhcmVudCBicmFuY2ggKGRlZ3JlZXMpXG4gICAgYW5nbGU6IDMwLFxuXG4gICAgLy8gTnVtYmVyIG9mIGxlYXZlc1xuICAgIGNvdW50OiAzLFxuXG4gICAgLy8gV2hlcmUgbGVhdmVzIHN0YXJ0IHRvIGdyb3cgb24gdGhlIGxlbmd0aCBvZiB0aGUgYnJhbmNoICgwIHRvIDEpXG4gICAgc3RhcnQ6IDAsXG5cbiAgICAvLyBTaXplIG9mIHRoZSBsZWF2ZXNcbiAgICBzaXplOiAxLjc1LFxuXG4gICAgLy8gVmFyaWFuY2UgaW4gbGVhZiBzaXplIGJldHdlZW4gZWFjaCBpbnN0YW5jZVxuICAgIHNpemVWYXJpYW5jZTogMC43LFxuXG4gICAgLy8gVGludCBjb2xvciBmb3IgdGhlIGxlYXZlc1xuICAgIHRpbnQ6IDB4ZmZmZmZmLFxuXG4gICAgLy8gQ29udHJvbHMgdHJhbnNwYXJlbmN5IG9mIGxlYWYgdGV4dHVyZVxuICAgIGFscGhhVGVzdDogMC41LFxuICB9LFxufTsiLCJpbXBvcnQgKiBhcyBUSFJFRSBmcm9tICd0aHJlZSc7XG5pbXBvcnQgUk5HIGZyb20gJy4vcm5nJztcbmltcG9ydCB7IEJyYW5jaCB9IGZyb20gJy4vYnJhbmNoJztcbmltcG9ydCB7IEJpbGxib2FyZCwgVHJlZVR5cGUgfSBmcm9tICcuL2VudW1zJztcbmltcG9ydCB7IFRyZWVQYXJhbXMgfSBmcm9tICcuL3RyZWVQYXJhbXMnO1xuaW1wb3J0ICogYXMgdGV4dHVyZXMgZnJvbSAnLi90ZXh0dXJlcy9pbmRleC5qc29uJztcblxuY29uc3QgdGV4dHVyZUNhY2hlID0ge307XG5cbmNvbnN0IHRleHR1cmVMb2FkZXIgPSBuZXcgVEhSRUUuVGV4dHVyZUxvYWRlcigpO1xuY29uc3QgbG9hZFRleHR1cmUgPSAocGF0aCwgc2NhbGUgPSBuZXcgVEhSRUUuVmVjdG9yMigxLCAxKSkgPT4ge1xuICBpZiAodGV4dHVyZUNhY2hlW3BhdGhdKSB7XG4gICAgY29uc3QgdGV4dHVyZSA9IHRleHR1cmVDYWNoZVtwYXRoXTtcbiAgICB0ZXh0dXJlLndyYXBTID0gVEhSRUUuTWlycm9yZWRSZXBlYXRXcmFwcGluZztcbiAgICB0ZXh0dXJlLndyYXBUID0gVEhSRUUuTWlycm9yZWRSZXBlYXRXcmFwcGluZztcbiAgICByZXR1cm4gdGV4dHVyZTtcbiAgfSBlbHNlIHtcbiAgICBjb25zdCB1cmwgPSBuZXcgVVJMKHBhdGgsIGltcG9ydC5tZXRhLnVybCkuaHJlZjtcbiAgICBjb25zdCB0ZXh0dXJlID0gdGV4dHVyZUxvYWRlci5sb2FkKHVybCk7XG4gICAgdGV4dHVyZUNhY2hlW3BhdGhdID0gdGV4dHVyZTtcbiAgICByZXR1cm4gdGV4dHVyZTtcbiAgfVxufTtcblxuZXhwb3J0IGNsYXNzIFRyZWUgZXh0ZW5kcyBUSFJFRS5Hcm91cCB7XG4gIC8qKlxuICAgKiBAdHlwZSB7Uk5HfVxuICAgKi9cbiAgcm5nO1xuXG4gIC8qKlxuICAgKiBAdHlwZSB7VHJlZVBhcmFtc31cbiAgICovXG4gIHBhcmFtcztcblxuICAvKipcbiAgICogQHR5cGUge0JyYW5jaFtdfVxuICAgKi9cbiAgYnJhbmNoUXVldWUgPSBbXTtcblxuICAvKipcbiAgICogQHBhcmFtIHtUcmVlUGFyYW1zfSBwYXJhbXNcbiAgICovXG4gIGNvbnN0cnVjdG9yKHBhcmFtcyA9IFRyZWVQYXJhbXMpIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMucGFyYW1zID0gcGFyYW1zO1xuICAgIHRoaXMuYnJhbmNoZXNNZXNoID0gbmV3IFRIUkVFLk1lc2goKTtcbiAgICB0aGlzLmxlYXZlc01lc2ggPSBuZXcgVEhSRUUuTWVzaCgpO1xuICAgIHRoaXMuYWRkKHRoaXMuYnJhbmNoZXNNZXNoKTtcbiAgICB0aGlzLmFkZCh0aGlzLmxlYXZlc01lc2gpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlIGEgbmV3IHRyZWVcbiAgICovXG4gIGFzeW5jIGdlbmVyYXRlKCkge1xuICAgIC8vIENsZWFuIHVwIG9sZCBnZW9tZXRyeVxuICAgIHRoaXMuYnJhbmNoZXMgPSB7XG4gICAgICB2ZXJ0czogW10sXG4gICAgICBub3JtYWxzOiBbXSxcbiAgICAgIGluZGljZXM6IFtdLFxuICAgICAgdXZzOiBbXSxcbiAgICB9O1xuXG4gICAgdGhpcy5sZWF2ZXMgPSB7XG4gICAgICB2ZXJ0czogW10sXG4gICAgICBub3JtYWxzOiBbXSxcbiAgICAgIGluZGljZXM6IFtdLFxuICAgICAgdXZzOiBbXSxcbiAgICB9O1xuXG4gICAgdGhpcy5ybmcgPSBuZXcgUk5HKHRoaXMucGFyYW1zLnNlZWQpO1xuXG4gICAgLy8gQ3JlYXRlIHRoZSB0cnVuayBvZiB0aGUgdHJlZSBmaXJzdFxuICAgIHRoaXMuYnJhbmNoUXVldWUucHVzaChcbiAgICAgIG5ldyBCcmFuY2goXG4gICAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKCksXG4gICAgICAgIG5ldyBUSFJFRS5FdWxlcigpLFxuICAgICAgICB0aGlzLnBhcmFtcy5icmFuY2gubGVuZ3RoWzBdLFxuICAgICAgICB0aGlzLnBhcmFtcy5icmFuY2gucmFkaXVzWzBdLFxuICAgICAgICAwLFxuICAgICAgICB0aGlzLnBhcmFtcy5icmFuY2guc2VjdGlvbnNbMF0sXG4gICAgICAgIHRoaXMucGFyYW1zLmJyYW5jaC5zZWdtZW50c1swXSxcbiAgICAgICksXG4gICAgKTtcblxuICAgIHdoaWxlICh0aGlzLmJyYW5jaFF1ZXVlLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnN0IGJyYW5jaCA9IHRoaXMuYnJhbmNoUXVldWUuc2hpZnQoKTtcbiAgICAgIHRoaXMuZ2VuZXJhdGVCcmFuY2goYnJhbmNoKTtcbiAgICB9XG5cbiAgICB0aGlzLmNyZWF0ZUJyYW5jaGVzR2VvbWV0cnkoKTtcbiAgICB0aGlzLmNyZWF0ZUxlYXZlc0dlb21ldHJ5KCk7XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGVzIGEgbmV3IGJyYW5jaFxuICAgKiBAcGFyYW0ge0JyYW5jaH0gYnJhbmNoXG4gICAqIEByZXR1cm5zXG4gICAqL1xuICBnZW5lcmF0ZUJyYW5jaChicmFuY2gpIHtcbiAgICAvLyBVc2VkIGxhdGVyIGZvciBnZW9tZXRyeSBpbmRleCBnZW5lcmF0aW9uXG4gICAgY29uc3QgaW5kZXhPZmZzZXQgPSB0aGlzLmJyYW5jaGVzLnZlcnRzLmxlbmd0aCAvIDM7XG5cbiAgICBsZXQgc2VjdGlvbk9yaWVudGF0aW9uID0gYnJhbmNoLm9yaWVudGF0aW9uLmNsb25lKCk7XG4gICAgbGV0IHNlY3Rpb25PcmlnaW4gPSBicmFuY2gub3JpZ2luLmNsb25lKCk7XG4gICAgbGV0IHNlY3Rpb25MZW5ndGggPVxuICAgICAgYnJhbmNoLmxlbmd0aCAvXG4gICAgICBicmFuY2guc2VjdGlvbkNvdW50IC9cbiAgICAgICh0aGlzLnBhcmFtcy50eXBlID09PSAnRGVjaWR1b3VzJyA/IHRoaXMucGFyYW1zLmxldmVscyAtIDEgOiAxKTtcblxuICAgIC8vIFRoaXMgaW5mb3JtYXRpb24gaXMgdXNlZCBmb3IgZ2VuZXJhdGluZyBjaGlsZCBicmFuY2hlcyBhZnRlciB0aGUgYnJhbmNoXG4gICAgLy8gZ2VvbWV0cnkgaGFzIGJlZW4gY29uc3RydWN0ZWRcbiAgICBsZXQgc2VjdGlvbnMgPSBbXTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDw9IGJyYW5jaC5zZWN0aW9uQ291bnQ7IGkrKykge1xuICAgICAgbGV0IHNlY3Rpb25SYWRpdXMgPSBicmFuY2gucmFkaXVzO1xuXG4gICAgICAvLyBJZiBmaW5hbCBzZWN0aW9uIG9mIGZpbmFsIGxldmVsLCBzZXQgcmFkaXVzIHRvIGVmZmVjaXZlbHkgemVyb1xuICAgICAgaWYgKFxuICAgICAgICBpID09PSBicmFuY2guc2VjdGlvbkNvdW50ICYmXG4gICAgICAgIGJyYW5jaC5sZXZlbCA9PT0gdGhpcy5wYXJhbXMubGV2ZWxzXG4gICAgICApIHtcbiAgICAgICAgc2VjdGlvblJhZGl1cyA9IDAuMDAxO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLnBhcmFtcy50eXBlID09PSBUcmVlVHlwZS5EZWNpZHVvdXMpIHtcbiAgICAgICAgc2VjdGlvblJhZGl1cyAqPVxuICAgICAgICAgIDEgLSB0aGlzLnBhcmFtcy5icmFuY2gudGFwZXJbYnJhbmNoLmxldmVsXSAqIChpIC8gYnJhbmNoLnNlY3Rpb25Db3VudCk7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMucGFyYW1zLnR5cGUgPT09IFRyZWVUeXBlLkV2ZXJncmVlbikge1xuICAgICAgICAvLyBFdmVyZ3JlZW5zIGRvIG5vdCBoYXZlIGEgdGVybWluYWwgYnJhbmNoIHNvIHRoZXkgaGF2ZSBhIHRhcGVyIG9mIDFcbiAgICAgICAgc2VjdGlvblJhZGl1cyAqPSAxIC0gKGkgLyBicmFuY2guc2VjdGlvbkNvdW50KTtcbiAgICAgIH1cblxuICAgICAgLy8gQ3JlYXRlIHRoZSBzZWdtZW50cyB0aGF0IG1ha2UgdXAgdGhpcyBzZWN0aW9uLlxuICAgICAgbGV0IGZpcnN0O1xuICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBicmFuY2guc2VnbWVudENvdW50OyBqKyspIHtcbiAgICAgICAgbGV0IGFuZ2xlID0gKDIuMCAqIE1hdGguUEkgKiBqKSAvIGJyYW5jaC5zZWdtZW50Q291bnQ7XG5cbiAgICAgICAgLy8gQ3JlYXRlIHRoZSBzZWdtZW50IHZlcnRleFxuICAgICAgICBjb25zdCB2ZXJ0ZXggPSBuZXcgVEhSRUUuVmVjdG9yMyhNYXRoLmNvcyhhbmdsZSksIDAsIE1hdGguc2luKGFuZ2xlKSlcbiAgICAgICAgICAubXVsdGlwbHlTY2FsYXIoc2VjdGlvblJhZGl1cylcbiAgICAgICAgICAuYXBwbHlFdWxlcihzZWN0aW9uT3JpZW50YXRpb24pXG4gICAgICAgICAgLmFkZChzZWN0aW9uT3JpZ2luKTtcblxuICAgICAgICBjb25zdCBub3JtYWwgPSBuZXcgVEhSRUUuVmVjdG9yMyhNYXRoLmNvcyhhbmdsZSksIDAsIE1hdGguc2luKGFuZ2xlKSlcbiAgICAgICAgICAuYXBwbHlFdWxlcihzZWN0aW9uT3JpZW50YXRpb24pXG4gICAgICAgICAgLm5vcm1hbGl6ZSgpO1xuXG4gICAgICAgIGNvbnN0IHV2ID0gbmV3IFRIUkVFLlZlY3RvcjIoXG4gICAgICAgICAgaiAvIGJyYW5jaC5zZWdtZW50Q291bnQsXG4gICAgICAgICAgKGkgJSAyID09PSAwKSA/IDAgOiAxLFxuICAgICAgICApO1xuXG4gICAgICAgIHRoaXMuYnJhbmNoZXMudmVydHMucHVzaCguLi5PYmplY3QudmFsdWVzKHZlcnRleCkpO1xuICAgICAgICB0aGlzLmJyYW5jaGVzLm5vcm1hbHMucHVzaCguLi5PYmplY3QudmFsdWVzKG5vcm1hbCkpO1xuICAgICAgICB0aGlzLmJyYW5jaGVzLnV2cy5wdXNoKC4uLk9iamVjdC52YWx1ZXModXYpKTtcblxuICAgICAgICBpZiAoaiA9PT0gMCkge1xuICAgICAgICAgIGZpcnN0ID0geyB2ZXJ0ZXgsIG5vcm1hbCwgdXYgfTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBEdXBsaWNhdGUgdGhlIGZpcnN0IHZlcnRleCBzbyB0aGVyZSBpcyBjb250aW51aXR5IGluIHRoZSBVViBtYXBwaW5nXG4gICAgICB0aGlzLmJyYW5jaGVzLnZlcnRzLnB1c2goLi4uT2JqZWN0LnZhbHVlcyhmaXJzdC52ZXJ0ZXgpKTtcbiAgICAgIHRoaXMuYnJhbmNoZXMubm9ybWFscy5wdXNoKC4uLk9iamVjdC52YWx1ZXMoZmlyc3Qubm9ybWFsKSk7XG4gICAgICB0aGlzLmJyYW5jaGVzLnV2cy5wdXNoKDEsIGZpcnN0LnV2LnkpO1xuXG4gICAgICAvLyBVc2UgdGhpcyBpbmZvcm1hdGlvbiBsYXRlciBvbiB3aGVuIGdlbmVyYXRpbmcgY2hpbGQgYnJhbmNoZXNcbiAgICAgIHNlY3Rpb25zLnB1c2goe1xuICAgICAgICBvcmlnaW46IHNlY3Rpb25PcmlnaW4uY2xvbmUoKSxcbiAgICAgICAgb3JpZW50YXRpb246IHNlY3Rpb25PcmllbnRhdGlvbi5jbG9uZSgpLFxuICAgICAgICByYWRpdXM6IHNlY3Rpb25SYWRpdXMsXG4gICAgICB9KTtcblxuICAgICAgc2VjdGlvbk9yaWdpbi5hZGQoXG4gICAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKDAsIHNlY3Rpb25MZW5ndGgsIDApLmFwcGx5RXVsZXIoc2VjdGlvbk9yaWVudGF0aW9uKSxcbiAgICAgICk7XG5cbiAgICAgIC8vIFBlcnR1cmIgdGhlIG9yaWVudGF0aW9uIG9mIHRoZSBuZXh0IHNlY3Rpb24gcmFuZG9tbHkuIFRoZSBoaWdoZXIgdGhlXG4gICAgICAvLyBnbmFybGluZXNzLCB0aGUgbGFyZ2VyIHBvdGVudGlhbCBwZXJ0dXJiYXRpb25cbiAgICAgIGNvbnN0IGduYXJsaW5lc3MgPVxuICAgICAgICBNYXRoLm1heCgxLCAxIC8gTWF0aC5zcXJ0KHNlY3Rpb25SYWRpdXMpKSAqXG4gICAgICAgIHRoaXMucGFyYW1zLmJyYW5jaC5nbmFybGluZXNzW2JyYW5jaC5sZXZlbF07XG5cbiAgICAgIHNlY3Rpb25PcmllbnRhdGlvbi54ICs9IHRoaXMucm5nLnJhbmRvbShnbmFybGluZXNzLCAtZ25hcmxpbmVzcyk7XG4gICAgICBzZWN0aW9uT3JpZW50YXRpb24ueiArPSB0aGlzLnJuZy5yYW5kb20oZ25hcmxpbmVzcywgLWduYXJsaW5lc3MpO1xuXG4gICAgICAvLyBBcHBseSBncm93dGggZm9yY2UgdG8gdGhlIGJyYW5jaFxuICAgICAgY29uc3QgcVNlY3Rpb24gPSBuZXcgVEhSRUUuUXVhdGVybmlvbigpLnNldEZyb21FdWxlcihzZWN0aW9uT3JpZW50YXRpb24pO1xuXG4gICAgICBjb25zdCBxVHdpc3QgPSBuZXcgVEhSRUUuUXVhdGVybmlvbigpLnNldEZyb21BeGlzQW5nbGUoXG4gICAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKDAsIDEsIDApLFxuICAgICAgICB0aGlzLnBhcmFtcy5icmFuY2gudHdpc3RbYnJhbmNoLmxldmVsXSxcbiAgICAgICk7XG5cbiAgICAgIGNvbnN0IHFGb3JjZSA9IG5ldyBUSFJFRS5RdWF0ZXJuaW9uKCkuc2V0RnJvbVVuaXRWZWN0b3JzKFxuICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMygwLCAxLCAwKSxcbiAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoKS5jb3B5KHRoaXMucGFyYW1zLmJyYW5jaC5mb3JjZS5kaXJlY3Rpb24pLFxuICAgICAgKTtcblxuICAgICAgcVNlY3Rpb24ubXVsdGlwbHkocVR3aXN0KTtcbiAgICAgIHFTZWN0aW9uLnJvdGF0ZVRvd2FyZHMoXG4gICAgICAgIHFGb3JjZSxcbiAgICAgICAgdGhpcy5wYXJhbXMuYnJhbmNoLmZvcmNlLnN0cmVuZ3RoIC8gc2VjdGlvblJhZGl1cyxcbiAgICAgICk7XG5cbiAgICAgIHNlY3Rpb25PcmllbnRhdGlvbi5zZXRGcm9tUXVhdGVybmlvbihxU2VjdGlvbik7XG4gICAgfVxuXG4gICAgdGhpcy5nZW5lcmF0ZUJyYW5jaEluZGljZXMoaW5kZXhPZmZzZXQsIGJyYW5jaCk7XG5cbiAgICAvLyBEZWNpZHVvdXMgdHJlZXMgaGF2ZSBhIHRlcm1pbmFsIGJyYW5jaCB0aGF0IGdyb3dzIG91dCBvZiB0aGVcbiAgICAvLyBlbmQgb2YgdGhlIHBhcmVudCBicmFuY2hcbiAgICBpZiAodGhpcy5wYXJhbXMudHlwZSA9PT0gJ2RlY2lkdW91cycpIHtcbiAgICAgIGNvbnN0IGxhc3RTZWN0aW9uID0gc2VjdGlvbnNbc2VjdGlvbnMubGVuZ3RoIC0gMV07XG5cbiAgICAgIGlmIChicmFuY2gubGV2ZWwgPCB0aGlzLnBhcmFtcy5sZXZlbHMpIHtcbiAgICAgICAgdGhpcy5icmFuY2hRdWV1ZS5wdXNoKFxuICAgICAgICAgIG5ldyBCcmFuY2goXG4gICAgICAgICAgICBsYXN0U2VjdGlvbi5vcmlnaW4sXG4gICAgICAgICAgICBsYXN0U2VjdGlvbi5vcmllbnRhdGlvbixcbiAgICAgICAgICAgIHRoaXMucGFyYW1zLmJyYW5jaC5sZW5ndGhbYnJhbmNoLmxldmVsICsgMV0gLyAyLFxuICAgICAgICAgICAgbGFzdFNlY3Rpb24ucmFkaXVzLFxuICAgICAgICAgICAgYnJhbmNoLmxldmVsICsgMSxcbiAgICAgICAgICAgIC8vIFNlY3Rpb24gY291bnQgYW5kIHNlZ21lbnQgY291bnQgbXVzdCBiZSBzYW1lIGFzIHBhcmVudCBicmFuY2hcbiAgICAgICAgICAgIC8vIHNpbmNlIHRoZSBjaGlsZCBicmFuY2ggaXMgZ3Jvd2luZyBmcm9tIHRoZSBlbmQgb2YgdGhlIHBhcmVudCBicmFuY2hcbiAgICAgICAgICAgIGJyYW5jaC5zZWN0aW9uQ291bnQsXG4gICAgICAgICAgICBicmFuY2guc2VnbWVudENvdW50LFxuICAgICAgICAgICksXG4gICAgICAgICk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmdlbmVyYXRlTGVhZihsYXN0U2VjdGlvbi5vcmlnaW4sIGxhc3RTZWN0aW9uLm9yaWVudGF0aW9uKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBJZiB3ZSBhcmUgb24gdGhlIGxhc3QgYnJhbmNoIGxldmVsLCBnZW5lcmF0ZSBsZWF2ZXNcbiAgICBpZiAoYnJhbmNoLmxldmVsID09PSB0aGlzLnBhcmFtcy5sZXZlbHMpIHtcbiAgICAgIHRoaXMuZ2VuZXJhdGVMZWF2ZXMoc2VjdGlvbnMpO1xuICAgIH0gZWxzZSBpZiAoYnJhbmNoLmxldmVsIDwgdGhpcy5wYXJhbXMubGV2ZWxzKSB7XG4gICAgICB0aGlzLmdlbmVyYXRlQ2hpbGRCcmFuY2hlcyhcbiAgICAgICAgdGhpcy5wYXJhbXMuYnJhbmNoLmNoaWxkcmVuW2JyYW5jaC5sZXZlbF0sXG4gICAgICAgIGJyYW5jaC5sZXZlbCArIDEsXG4gICAgICAgIHNlY3Rpb25zKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGUgYnJhbmNoZXMgZnJvbSBhIHBhcmVudCBicmFuY2hcbiAgICogQHBhcmFtIHtudW1iZXJ9IGNvdW50IFRoZSBudW1iZXIgb2YgY2hpbGQgYnJhbmNoZXMgdG8gZ2VuZXJhdGVcbiAgICogQHBhcmFtIHtudW1iZXJ9IGxldmVsIFRoZSBsZXZlbCBvZiB0aGUgY2hpbGQgYnJhbmNoZXNcbiAgICogQHBhcmFtIHt7XG4gICAqICBvcmlnaW46IFRIUkVFLlZlY3RvcjMsXG4gICAqICBvcmllbnRhdGlvbjogVEhSRUUuRXVsZXIsXG4gICAqICByYWRpdXM6IG51bWJlclxuICAgKiB9W119IHNlY3Rpb25zIFRoZSBwYXJlbnQgYnJhbmNoJ3Mgc2VjdGlvbnNcbiAgICogQHJldHVybnNcbiAgICovXG4gIGdlbmVyYXRlQ2hpbGRCcmFuY2hlcyhjb3VudCwgbGV2ZWwsIHNlY3Rpb25zKSB7XG4gICAgY29uc3QgcmFkaWFsT2Zmc2V0ID0gdGhpcy5ybmcucmFuZG9tKCk7XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyBpKyspIHtcbiAgICAgIC8vIERldGVybWluZSBob3cgZmFyIGFsb25nIHRoZSBsZW5ndGggb2YgdGhlIHBhcmVudCBicmFuY2ggdGhlIGNoaWxkXG4gICAgICAvLyBicmFuY2ggc2hvdWxkIG9yaWdpbmF0ZSBmcm9tICgwIHRvIDEpXG4gICAgICBsZXQgY2hpbGRCcmFuY2hTdGFydCA9IHRoaXMucm5nLnJhbmRvbSgxLjAsIHRoaXMucGFyYW1zLmJyYW5jaC5zdGFydFtsZXZlbF0pO1xuXG4gICAgICAvLyBGaW5kIHdoaWNoIHNlY3Rpb25zIGFyZSBvbiBlaXRoZXIgc2lkZSBvZiB0aGUgY2hpbGQgYnJhbmNoIG9yaWdpbiBwb2ludFxuICAgICAgLy8gc28gd2UgY2FuIGRldGVybWluZSB0aGUgb3JpZ2luLCBvcmllbnRhdGlvbiBhbmQgcmFkaXVzIG9mIHRoZSBicmFuY2hcbiAgICAgIGNvbnN0IHNlY3Rpb25JbmRleCA9IE1hdGguZmxvb3IoY2hpbGRCcmFuY2hTdGFydCAqIChzZWN0aW9ucy5sZW5ndGggLSAxKSk7XG4gICAgICBsZXQgc2VjdGlvbkEsIHNlY3Rpb25CO1xuICAgICAgc2VjdGlvbkEgPSBzZWN0aW9uc1tzZWN0aW9uSW5kZXhdO1xuICAgICAgaWYgKHNlY3Rpb25JbmRleCA9PT0gc2VjdGlvbnMubGVuZ3RoIC0gMSkge1xuICAgICAgICBzZWN0aW9uQiA9IHNlY3Rpb25BO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc2VjdGlvbkIgPSBzZWN0aW9uc1tzZWN0aW9uSW5kZXggKyAxXTtcbiAgICAgIH1cblxuICAgICAgLy8gRmluZCBub3JtYWxpemVkIGRpc3RhbmNlIGZyb20gc2VjdGlvbiBBIHRvIHNlY3Rpb24gQiAoMCB0byAxKVxuICAgICAgY29uc3QgYWxwaGEgPVxuICAgICAgICAoY2hpbGRCcmFuY2hTdGFydCAtIHNlY3Rpb25JbmRleCAvIChzZWN0aW9ucy5sZW5ndGggLSAxKSkgL1xuICAgICAgICAoMSAvIChzZWN0aW9ucy5sZW5ndGggLSAxKSk7XG5cbiAgICAgIC8vIExpbmVhcmx5IGludGVycG9sYXRlIG9yaWdpbiBmcm9tIHNlY3Rpb24gQSB0byBzZWN0aW9uIEJcbiAgICAgIGNvbnN0IGNoaWxkQnJhbmNoT3JpZ2luID0gbmV3IFRIUkVFLlZlY3RvcjMoKS5sZXJwVmVjdG9ycyhcbiAgICAgICAgc2VjdGlvbkEub3JpZ2luLFxuICAgICAgICBzZWN0aW9uQi5vcmlnaW4sXG4gICAgICAgIGFscGhhLFxuICAgICAgKTtcblxuICAgICAgLy8gTGluZWFybHkgaW50ZXJwb2xhdGUgcmFkaXVzXG4gICAgICBjb25zdCBjaGlsZEJyYW5jaFJhZGl1cyA9XG4gICAgICAgIHRoaXMucGFyYW1zLmJyYW5jaC5yYWRpdXNbbGV2ZWxdICpcbiAgICAgICAgKCgxIC0gYWxwaGEpICogc2VjdGlvbkEucmFkaXVzICsgYWxwaGEgKiBzZWN0aW9uQi5yYWRpdXMpO1xuXG4gICAgICAvLyBMaW5lYXJsbHkgaW50ZXJwb2xhdGUgdGhlIG9yaWVudGF0aW9uXG4gICAgICBjb25zdCBxQSA9IG5ldyBUSFJFRS5RdWF0ZXJuaW9uKCkuc2V0RnJvbUV1bGVyKHNlY3Rpb25BLm9yaWVudGF0aW9uKTtcbiAgICAgIGNvbnN0IHFCID0gbmV3IFRIUkVFLlF1YXRlcm5pb24oKS5zZXRGcm9tRXVsZXIoc2VjdGlvbkIub3JpZW50YXRpb24pO1xuICAgICAgY29uc3QgcGFyZW50T3JpZW50YXRpb24gPSBuZXcgVEhSRUUuRXVsZXIoKS5zZXRGcm9tUXVhdGVybmlvbihcbiAgICAgICAgcUIuc2xlcnAocUEsIGFscGhhKSxcbiAgICAgICk7XG5cbiAgICAgIC8vIENhbGN1bGF0ZSB0aGUgYW5nbGUgb2Zmc2V0IGZyb20gdGhlIHBhcmVudCBicmFuY2ggYW5kIHRoZSByYWRpYWwgYW5nbGVcbiAgICAgIGNvbnN0IHJhZGlhbEFuZ2xlID0gMi4wICogTWF0aC5QSSAqIChyYWRpYWxPZmZzZXQgKyBpIC8gY291bnQpO1xuICAgICAgY29uc3QgcTEgPSBuZXcgVEhSRUUuUXVhdGVybmlvbigpLnNldEZyb21BeGlzQW5nbGUoXG4gICAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKDEsIDAsIDApLFxuICAgICAgICB0aGlzLnBhcmFtcy5icmFuY2guYW5nbGVbbGV2ZWxdIC8gKDE4MCAvIE1hdGguUEkpLFxuICAgICAgKTtcbiAgICAgIGNvbnN0IHEyID0gbmV3IFRIUkVFLlF1YXRlcm5pb24oKS5zZXRGcm9tQXhpc0FuZ2xlKFxuICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMygwLCAxLCAwKSxcbiAgICAgICAgcmFkaWFsQW5nbGUsXG4gICAgICApO1xuICAgICAgY29uc3QgcTMgPSBuZXcgVEhSRUUuUXVhdGVybmlvbigpLnNldEZyb21FdWxlcihwYXJlbnRPcmllbnRhdGlvbik7XG5cbiAgICAgIGNvbnN0IGNoaWxkQnJhbmNoT3JpZW50YXRpb24gPSBuZXcgVEhSRUUuRXVsZXIoKS5zZXRGcm9tUXVhdGVybmlvbihcbiAgICAgICAgcTMubXVsdGlwbHkocTIubXVsdGlwbHkocTEpKSxcbiAgICAgICk7XG5cbiAgICAgIGxldCBjaGlsZEJyYW5jaExlbmd0aCA9XG4gICAgICAgIHRoaXMucGFyYW1zLmJyYW5jaC5sZW5ndGhbbGV2ZWxdICpcbiAgICAgICAgKHRoaXMucGFyYW1zLnR5cGUgPT09IFRyZWVUeXBlLkV2ZXJncmVlblxuICAgICAgICAgID8gMS4wIC0gY2hpbGRCcmFuY2hTdGFydFxuICAgICAgICAgIDogMS4wKTtcblxuICAgICAgdGhpcy5icmFuY2hRdWV1ZS5wdXNoKFxuICAgICAgICBuZXcgQnJhbmNoKFxuICAgICAgICAgIGNoaWxkQnJhbmNoT3JpZ2luLFxuICAgICAgICAgIGNoaWxkQnJhbmNoT3JpZW50YXRpb24sXG4gICAgICAgICAgY2hpbGRCcmFuY2hMZW5ndGgsXG4gICAgICAgICAgY2hpbGRCcmFuY2hSYWRpdXMsXG4gICAgICAgICAgbGV2ZWwsXG4gICAgICAgICAgdGhpcy5wYXJhbXMuYnJhbmNoLnNlY3Rpb25zW2xldmVsXSxcbiAgICAgICAgICB0aGlzLnBhcmFtcy5icmFuY2guc2VnbWVudHNbbGV2ZWxdLFxuICAgICAgICApLFxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogTG9naWMgZm9yIHNwYXduaW5nIGNoaWxkIGJyYW5jaGVzIGZyb20gYSBwYXJlbnQgYnJhbmNoJ3Mgc2VjdGlvblxuICAgKiBAcGFyYW0ge3tcbiAgKiAgb3JpZ2luOiBUSFJFRS5WZWN0b3IzLFxuICAqICBvcmllbnRhdGlvbjogVEhSRUUuRXVsZXIsXG4gICogIHJhZGl1czogbnVtYmVyXG4gICogfVtdfSBzZWN0aW9ucyBUaGUgcGFyZW50IGJyYW5jaCdzIHNlY3Rpb25zXG4gICogQHJldHVybnNcbiAgKi9cbiAgZ2VuZXJhdGVMZWF2ZXMoc2VjdGlvbnMpIHtcbiAgICBjb25zdCByYWRpYWxPZmZzZXQgPSB0aGlzLnJuZy5yYW5kb20oKTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5wYXJhbXMubGVhdmVzLmNvdW50OyBpKyspIHtcbiAgICAgIC8vIERldGVybWluZSBob3cgZmFyIGFsb25nIHRoZSBsZW5ndGggb2YgdGhlIHBhcmVudFxuICAgICAgLy8gYnJhbmNoIHRoZSBsZWFmIHNob3VsZCBvcmlnaW5hdGUgZnJvbSAoMCB0byAxKVxuICAgICAgbGV0IGxlYWZTdGFydCA9IHRoaXMucm5nLnJhbmRvbSgxLjAsIHRoaXMucGFyYW1zLmxlYXZlcy5zdGFydCk7XG5cbiAgICAgIC8vIEZpbmQgd2hpY2ggc2VjdGlvbnMgYXJlIG9uIGVpdGhlciBzaWRlIG9mIHRoZSBjaGlsZCBicmFuY2ggb3JpZ2luIHBvaW50XG4gICAgICAvLyBzbyB3ZSBjYW4gZGV0ZXJtaW5lIHRoZSBvcmlnaW4sIG9yaWVudGF0aW9uIGFuZCByYWRpdXMgb2YgdGhlIGJyYW5jaFxuICAgICAgY29uc3Qgc2VjdGlvbkluZGV4ID0gTWF0aC5mbG9vcihsZWFmU3RhcnQgKiAoc2VjdGlvbnMubGVuZ3RoIC0gMSkpO1xuICAgICAgbGV0IHNlY3Rpb25BLCBzZWN0aW9uQjtcbiAgICAgIHNlY3Rpb25BID0gc2VjdGlvbnNbc2VjdGlvbkluZGV4XTtcbiAgICAgIGlmIChzZWN0aW9uSW5kZXggPT09IHNlY3Rpb25zLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgc2VjdGlvbkIgPSBzZWN0aW9uQTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNlY3Rpb25CID0gc2VjdGlvbnNbc2VjdGlvbkluZGV4ICsgMV07XG4gICAgICB9XG5cbiAgICAgIC8vIEZpbmQgbm9ybWFsaXplZCBkaXN0YW5jZSBmcm9tIHNlY3Rpb24gQSB0byBzZWN0aW9uIEIgKDAgdG8gMSlcbiAgICAgIGNvbnN0IGFscGhhID1cbiAgICAgICAgKGxlYWZTdGFydCAtIHNlY3Rpb25JbmRleCAvIChzZWN0aW9ucy5sZW5ndGggLSAxKSkgL1xuICAgICAgICAoMSAvIChzZWN0aW9ucy5sZW5ndGggLSAxKSk7XG5cbiAgICAgIC8vIExpbmVhcmx5IGludGVycG9sYXRlIG9yaWdpbiBmcm9tIHNlY3Rpb24gQSB0byBzZWN0aW9uIEJcbiAgICAgIGNvbnN0IGxlYWZPcmlnaW4gPSBuZXcgVEhSRUUuVmVjdG9yMygpLmxlcnBWZWN0b3JzKFxuICAgICAgICBzZWN0aW9uQS5vcmlnaW4sXG4gICAgICAgIHNlY3Rpb25CLm9yaWdpbixcbiAgICAgICAgYWxwaGEsXG4gICAgICApO1xuXG4gICAgICAvLyBMaW5lYXJsbHkgaW50ZXJwb2xhdGUgdGhlIG9yaWVudGF0aW9uXG4gICAgICBjb25zdCBxQSA9IG5ldyBUSFJFRS5RdWF0ZXJuaW9uKCkuc2V0RnJvbUV1bGVyKHNlY3Rpb25BLm9yaWVudGF0aW9uKTtcbiAgICAgIGNvbnN0IHFCID0gbmV3IFRIUkVFLlF1YXRlcm5pb24oKS5zZXRGcm9tRXVsZXIoc2VjdGlvbkIub3JpZW50YXRpb24pO1xuICAgICAgY29uc3QgcGFyZW50T3JpZW50YXRpb24gPSBuZXcgVEhSRUUuRXVsZXIoKS5zZXRGcm9tUXVhdGVybmlvbihcbiAgICAgICAgcUIuc2xlcnAocUEsIGFscGhhKSxcbiAgICAgICk7XG5cbiAgICAgIC8vIENhbGN1bGF0ZSB0aGUgYW5nbGUgb2Zmc2V0IGZyb20gdGhlIHBhcmVudCBicmFuY2ggYW5kIHRoZSByYWRpYWwgYW5nbGVcbiAgICAgIGNvbnN0IHJhZGlhbEFuZ2xlID0gMi4wICogTWF0aC5QSSAqIChyYWRpYWxPZmZzZXQgKyBpIC8gdGhpcy5wYXJhbXMubGVhdmVzLmNvdW50KTtcbiAgICAgIGNvbnN0IHExID0gbmV3IFRIUkVFLlF1YXRlcm5pb24oKS5zZXRGcm9tQXhpc0FuZ2xlKFxuICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMygxLCAwLCAwKSxcbiAgICAgICAgdGhpcy5wYXJhbXMubGVhdmVzLmFuZ2xlIC8gKDE4MCAvIE1hdGguUEkpLFxuICAgICAgKTtcbiAgICAgIGNvbnN0IHEyID0gbmV3IFRIUkVFLlF1YXRlcm5pb24oKS5zZXRGcm9tQXhpc0FuZ2xlKFxuICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMygwLCAxLCAwKSxcbiAgICAgICAgcmFkaWFsQW5nbGUsXG4gICAgICApO1xuICAgICAgY29uc3QgcTMgPSBuZXcgVEhSRUUuUXVhdGVybmlvbigpLnNldEZyb21FdWxlcihwYXJlbnRPcmllbnRhdGlvbik7XG5cbiAgICAgIGNvbnN0IGxlYWZPcmllbnRhdGlvbiA9IG5ldyBUSFJFRS5FdWxlcigpLnNldEZyb21RdWF0ZXJuaW9uKFxuICAgICAgICBxMy5tdWx0aXBseShxMi5tdWx0aXBseShxMSkpLFxuICAgICAgKTtcblxuICAgICAgdGhpcy5nZW5lcmF0ZUxlYWYobGVhZk9yaWdpbiwgbGVhZk9yaWVudGF0aW9uKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAqIEdlbmVyYXRlcyBhIGxlYXZlc1xuICogQHBhcmFtIHtUSFJFRS5WZWN0b3IzfSBvcmlnaW4gVGhlIHN0YXJ0aW5nIHBvaW50IG9mIHRoZSBicmFuY2hcbiAqIEBwYXJhbSB7VEhSRUUuRXVsZXJ9IG9yaWVudGF0aW9uIFRoZSBzdGFydGluZyBvcmllbnRhdGlvbiBvZiB0aGUgYnJhbmNoXG4gKi9cbiAgZ2VuZXJhdGVMZWFmKG9yaWdpbiwgb3JpZW50YXRpb24pIHtcbiAgICBsZXQgaSA9IHRoaXMubGVhdmVzLnZlcnRzLmxlbmd0aCAvIDM7XG5cbiAgICAvLyBXaWR0aCBhbmQgbGVuZ3RoIG9mIHRoZSBsZWFmIHF1YWRcbiAgICBsZXQgbGVhZlNpemUgPVxuICAgICAgdGhpcy5wYXJhbXMubGVhdmVzLnNpemUgKlxuICAgICAgKDEgK1xuICAgICAgICB0aGlzLnJuZy5yYW5kb20oXG4gICAgICAgICAgdGhpcy5wYXJhbXMubGVhdmVzLnNpemVWYXJpYW5jZSxcbiAgICAgICAgICAtdGhpcy5wYXJhbXMubGVhdmVzLnNpemVWYXJpYW5jZSxcbiAgICAgICAgKSk7XG5cbiAgICBjb25zdCBXID0gbGVhZlNpemU7XG4gICAgY29uc3QgTCA9IDEuNSAqIGxlYWZTaXplO1xuXG4gICAgY29uc3QgY3JlYXRlTGVhZiA9IChyb3RhdGlvbikgPT4ge1xuICAgICAgLy8gQ3JlYXRlIHF1YWQgdmVydGljZXNcbiAgICAgIGNvbnN0IHYgPSBbXG4gICAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKC1XIC8gMiwgTCwgMCksXG4gICAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKC1XIC8gMiwgMCwgMCksXG4gICAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKFcgLyAyLCAwLCAwKSxcbiAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoVyAvIDIsIEwsIDApLFxuICAgICAgXS5tYXAoKHYpID0+XG4gICAgICAgIHZcbiAgICAgICAgICAuYXBwbHlFdWxlcihuZXcgVEhSRUUuRXVsZXIoMCwgcm90YXRpb24sIDApKVxuICAgICAgICAgIC5hcHBseUV1bGVyKG9yaWVudGF0aW9uKVxuICAgICAgICAgIC5hZGQob3JpZ2luKSxcbiAgICAgICk7XG5cbiAgICAgIHRoaXMubGVhdmVzLnZlcnRzLnB1c2goXG4gICAgICAgIHZbMF0ueCxcbiAgICAgICAgdlswXS55LFxuICAgICAgICB2WzBdLnosXG4gICAgICAgIHZbMV0ueCxcbiAgICAgICAgdlsxXS55LFxuICAgICAgICB2WzFdLnosXG4gICAgICAgIHZbMl0ueCxcbiAgICAgICAgdlsyXS55LFxuICAgICAgICB2WzJdLnosXG4gICAgICAgIHZbM10ueCxcbiAgICAgICAgdlszXS55LFxuICAgICAgICB2WzNdLnosXG4gICAgICApO1xuXG4gICAgICBjb25zdCBuID0gbmV3IFRIUkVFLlZlY3RvcjMoMCwgMCwgMSkuYXBwbHlFdWxlcihvcmllbnRhdGlvbik7XG4gICAgICB0aGlzLmxlYXZlcy5ub3JtYWxzLnB1c2goXG4gICAgICAgIG4ueCxcbiAgICAgICAgbi55LFxuICAgICAgICBuLnosXG4gICAgICAgIG4ueCxcbiAgICAgICAgbi55LFxuICAgICAgICBuLnosXG4gICAgICAgIG4ueCxcbiAgICAgICAgbi55LFxuICAgICAgICBuLnosXG4gICAgICAgIG4ueCxcbiAgICAgICAgbi55LFxuICAgICAgICBuLnosXG4gICAgICApO1xuICAgICAgdGhpcy5sZWF2ZXMudXZzLnB1c2goMCwgMSwgMCwgMCwgMSwgMCwgMSwgMSk7XG4gICAgICB0aGlzLmxlYXZlcy5pbmRpY2VzLnB1c2goaSwgaSArIDEsIGkgKyAyLCBpLCBpICsgMiwgaSArIDMpO1xuICAgICAgaSArPSA0O1xuICAgIH07XG5cbiAgICBjcmVhdGVMZWFmKDApO1xuICAgIGlmICh0aGlzLnBhcmFtcy5sZWF2ZXMuYmlsbGJvYXJkID09PSBCaWxsYm9hcmQuRG91YmxlKSB7XG4gICAgICBjcmVhdGVMZWFmKE1hdGguUEkgLyAyKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGVzIHRoZSBpbmRpY2VzIGZvciBicmFuY2ggZ2VvbWV0cnlcbiAgICogQHBhcmFtIHtCcmFuY2h9IGJyYW5jaFxuICAgKi9cbiAgZ2VuZXJhdGVCcmFuY2hJbmRpY2VzKGluZGV4T2Zmc2V0LCBicmFuY2gpIHtcbiAgICAvLyBCdWlsZCBnZW9tZXRyeSBlYWNoIHNlY3Rpb24gb2YgdGhlIGJyYW5jaCAoY3lsaW5kZXIgd2l0aG91dCBlbmQgY2FwcylcbiAgICBsZXQgdjEsIHYyLCB2MywgdjQ7XG4gICAgY29uc3QgTiA9IGJyYW5jaC5zZWdtZW50Q291bnQgKyAxO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYnJhbmNoLnNlY3Rpb25Db3VudDsgaSsrKSB7XG4gICAgICAvLyBCdWlsZCB0aGUgcXVhZCBmb3IgZWFjaCBzZWdtZW50IG9mIHRoZSBzZWN0aW9uXG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGJyYW5jaC5zZWdtZW50Q291bnQ7IGorKykge1xuICAgICAgICB2MSA9IGluZGV4T2Zmc2V0ICsgaSAqIE4gKyBqO1xuICAgICAgICAvLyBUaGUgbGFzdCBzZWdtZW50IHdyYXBzIGFyb3VuZCBiYWNrIHRvIHRoZSBzdGFydGluZyBzZWdtZW50LCBzbyBvbWl0IGogKyAxIHRlcm1cbiAgICAgICAgdjIgPSBpbmRleE9mZnNldCArIGkgKiBOICsgKGogKyAxKTtcbiAgICAgICAgdjMgPSB2MSArIE47XG4gICAgICAgIHY0ID0gdjIgKyBOO1xuICAgICAgICB0aGlzLmJyYW5jaGVzLmluZGljZXMucHVzaCh2MSwgdjMsIHYyLCB2MiwgdjMsIHY0KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGVzIHRoZSBnZW9tZXRyeSBmb3IgdGhlIGJyYW5jaGVzXG4gICAqL1xuICBjcmVhdGVCcmFuY2hlc0dlb21ldHJ5KCkge1xuICAgIGNvbnN0IGcgPSBuZXcgVEhSRUUuQnVmZmVyR2VvbWV0cnkoKTtcbiAgICBnLnNldEF0dHJpYnV0ZShcbiAgICAgICdwb3NpdGlvbicsXG4gICAgICBuZXcgVEhSRUUuQnVmZmVyQXR0cmlidXRlKG5ldyBGbG9hdDMyQXJyYXkodGhpcy5icmFuY2hlcy52ZXJ0cyksIDMpLFxuICAgICk7XG4gICAgZy5zZXRBdHRyaWJ1dGUoXG4gICAgICAnbm9ybWFsJyxcbiAgICAgIG5ldyBUSFJFRS5CdWZmZXJBdHRyaWJ1dGUobmV3IEZsb2F0MzJBcnJheSh0aGlzLmJyYW5jaGVzLm5vcm1hbHMpLCAzKSxcbiAgICApO1xuICAgIGcuc2V0QXR0cmlidXRlKFxuICAgICAgJ3V2JyxcbiAgICAgIG5ldyBUSFJFRS5CdWZmZXJBdHRyaWJ1dGUobmV3IEZsb2F0MzJBcnJheSh0aGlzLmJyYW5jaGVzLnV2cyksIDIpLFxuICAgICk7XG4gICAgZy5zZXRJbmRleChcbiAgICAgIG5ldyBUSFJFRS5CdWZmZXJBdHRyaWJ1dGUobmV3IFVpbnQxNkFycmF5KHRoaXMuYnJhbmNoZXMuaW5kaWNlcyksIDEpLFxuICAgICk7XG4gICAgZy5jb21wdXRlQm91bmRpbmdTcGhlcmUoKTtcblxuICAgIGNvbnN0IG1hdCA9IG5ldyBUSFJFRS5NZXNoU3RhbmRhcmRNYXRlcmlhbCh7XG4gICAgICBuYW1lOiAnYnJhbmNoZXMnLFxuICAgICAgZmxhdFNoYWRpbmc6IHRoaXMucGFyYW1zLmZsYXRTaGFkaW5nLFxuICAgICAgY29sb3I6IHRoaXMucGFyYW1zLnRpbnQsXG4gICAgfSk7XG5cbiAgICB0aGlzLmJyYW5jaGVzTWVzaC5nZW9tZXRyeS5kaXNwb3NlKCk7XG4gICAgdGhpcy5icmFuY2hlc01lc2guZ2VvbWV0cnkgPSBnO1xuICAgIHRoaXMuYnJhbmNoZXNNZXNoLm1hdGVyaWFsLmRpc3Bvc2UoKTtcbiAgICB0aGlzLmJyYW5jaGVzTWVzaC5tYXRlcmlhbCA9IG1hdDtcbiAgICB0aGlzLmJyYW5jaGVzTWVzaC5jYXN0U2hhZG93ID0gdHJ1ZTtcbiAgICB0aGlzLmJyYW5jaGVzTWVzaC5yZWNlaXZlU2hhZG93ID0gdHJ1ZTtcblxuICAgIGlmICh0aGlzLnBhcmFtcy50ZXh0dXJlZCkge1xuICAgICAgdGhpcy5icmFuY2hlc01lc2gubWF0ZXJpYWwuYW9NYXAgPSBsb2FkVGV4dHVyZSh0ZXh0dXJlcy5iYXJrW3RoaXMucGFyYW1zLmJhcmsudHlwZV0uYW8sIHRoaXMucGFyYW1zLmJhcmsuc2NhbGUpO1xuICAgICAgdGhpcy5icmFuY2hlc01lc2gubWF0ZXJpYWwubWFwID0gbG9hZFRleHR1cmUodGV4dHVyZXMuYmFya1t0aGlzLnBhcmFtcy5iYXJrLnR5cGVdLmNvbG9yLCB0aGlzLnBhcmFtcy5iYXJrLnNjYWxlKTtcbiAgICAgIHRoaXMuYnJhbmNoZXNNZXNoLm1hdGVyaWFsLm5vcm1hbE1hcCA9IGxvYWRUZXh0dXJlKHRleHR1cmVzLmJhcmtbdGhpcy5wYXJhbXMuYmFyay50eXBlXS5ub3JtYWwsIHRoaXMucGFyYW1zLmJhcmsuc2NhbGUpO1xuICAgICAgdGhpcy5icmFuY2hlc01lc2gubWF0ZXJpYWwucm91Z2huZXNzTWFwID0gbG9hZFRleHR1cmUodGV4dHVyZXMuYmFya1t0aGlzLnBhcmFtcy5iYXJrLnR5cGVdLnJvdWdobmVzcywgdGhpcy5wYXJhbXMuYmFyay5zY2FsZSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlcyB0aGUgZ2VvbWV0cnkgZm9yIHRoZSBsZWF2ZXNcbiAgICovXG4gIGNyZWF0ZUxlYXZlc0dlb21ldHJ5KCkge1xuICAgIGNvbnN0IGcgPSBuZXcgVEhSRUUuQnVmZmVyR2VvbWV0cnkoKTtcbiAgICBnLnNldEF0dHJpYnV0ZShcbiAgICAgICdwb3NpdGlvbicsXG4gICAgICBuZXcgVEhSRUUuQnVmZmVyQXR0cmlidXRlKG5ldyBGbG9hdDMyQXJyYXkodGhpcy5sZWF2ZXMudmVydHMpLCAzKSxcbiAgICApO1xuICAgIGcuc2V0QXR0cmlidXRlKFxuICAgICAgJ3V2JyxcbiAgICAgIG5ldyBUSFJFRS5CdWZmZXJBdHRyaWJ1dGUobmV3IEZsb2F0MzJBcnJheSh0aGlzLmxlYXZlcy51dnMpLCAyKSxcbiAgICApO1xuICAgIGcuc2V0SW5kZXgoXG4gICAgICBuZXcgVEhSRUUuQnVmZmVyQXR0cmlidXRlKG5ldyBVaW50MTZBcnJheSh0aGlzLmxlYXZlcy5pbmRpY2VzKSwgMSksXG4gICAgKTtcbiAgICBnLmNvbXB1dGVWZXJ0ZXhOb3JtYWxzKCk7XG4gICAgZy5jb21wdXRlQm91bmRpbmdTcGhlcmUoKTtcblxuICAgIGNvbnN0IG1hdCA9IG5ldyBUSFJFRS5NZXNoU3RhbmRhcmRNYXRlcmlhbCh7XG4gICAgICBuYW1lOiAnbGVhdmVzJyxcbiAgICAgIGNvbG9yOiB0aGlzLnBhcmFtcy5sZWF2ZXMudGludCxcbiAgICAgIHNpZGU6IFRIUkVFLkRvdWJsZVNpZGUsXG4gICAgICBhbHBoYVRlc3Q6IHRoaXMucGFyYW1zLmxlYXZlcy5hbHBoYVRlc3QsXG4gICAgfSk7XG5cbiAgICB0aGlzLmxlYXZlc01lc2guZ2VvbWV0cnkuZGlzcG9zZSgpO1xuICAgIHRoaXMubGVhdmVzTWVzaC5nZW9tZXRyeSA9IGc7XG4gICAgdGhpcy5sZWF2ZXNNZXNoLm1hdGVyaWFsLmRpc3Bvc2UoKTtcbiAgICB0aGlzLmxlYXZlc01lc2gubWF0ZXJpYWwgPSBtYXQ7XG4gICAgdGhpcy5sZWF2ZXNNZXNoLm1hdGVyaWFsLm1hcCA9IGxvYWRUZXh0dXJlKHRleHR1cmVzLmxlYXZlc1t0aGlzLnBhcmFtcy5sZWF2ZXMudHlwZV0pO1xuICAgIHRoaXMubGVhdmVzTWVzaC5jYXN0U2hhZG93ID0gdHJ1ZTtcbiAgICB0aGlzLmxlYXZlc01lc2gucmVjZWl2ZVNoYWRvdyA9IHRydWU7XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJSTkciLCJzZWVkIiwiX19wdWJsaWNGaWVsZCIsIm1heCIsIm1pbiIsInJlc3VsdCIsIkJyYW5jaCIsIm9yaWdpbiIsIlRIUkVFIiwib3JpZW50YXRpb24iLCJsZW5ndGgiLCJyYWRpdXMiLCJsZXZlbCIsInNlY3Rpb25Db3VudCIsInNlZ21lbnRDb3VudCIsIkJhcmtUeXBlIiwiQmlsbGJvYXJkIiwiTGVhZlR5cGUiLCJUcmVlVHlwZSIsIlRyZWVQYXJhbXMiLCJ0ZXh0dXJlQ2FjaGUiLCJ0ZXh0dXJlTG9hZGVyIiwibG9hZFRleHR1cmUiLCJwYXRoIiwic2NhbGUiLCJ0ZXh0dXJlIiwidXJsIiwiX2RvY3VtZW50Q3VycmVudFNjcmlwdCIsIlRyZWUiLCJwYXJhbXMiLCJicmFuY2giLCJpbmRleE9mZnNldCIsInNlY3Rpb25PcmllbnRhdGlvbiIsInNlY3Rpb25PcmlnaW4iLCJzZWN0aW9uTGVuZ3RoIiwic2VjdGlvbnMiLCJpIiwic2VjdGlvblJhZGl1cyIsImZpcnN0IiwiaiIsImFuZ2xlIiwidmVydGV4Iiwibm9ybWFsIiwidXYiLCJnbmFybGluZXNzIiwicVNlY3Rpb24iLCJxVHdpc3QiLCJxRm9yY2UiLCJsYXN0U2VjdGlvbiIsImNvdW50IiwicmFkaWFsT2Zmc2V0IiwiY2hpbGRCcmFuY2hTdGFydCIsInNlY3Rpb25JbmRleCIsInNlY3Rpb25BIiwic2VjdGlvbkIiLCJhbHBoYSIsImNoaWxkQnJhbmNoT3JpZ2luIiwiY2hpbGRCcmFuY2hSYWRpdXMiLCJxQSIsInFCIiwicGFyZW50T3JpZW50YXRpb24iLCJyYWRpYWxBbmdsZSIsInExIiwicTIiLCJxMyIsImNoaWxkQnJhbmNoT3JpZW50YXRpb24iLCJjaGlsZEJyYW5jaExlbmd0aCIsImxlYWZTdGFydCIsImxlYWZPcmlnaW4iLCJsZWFmT3JpZW50YXRpb24iLCJsZWFmU2l6ZSIsIlciLCJMIiwiY3JlYXRlTGVhZiIsInJvdGF0aW9uIiwidiIsIm4iLCJ2MSIsInYyIiwidjMiLCJ2NCIsIk4iLCJnIiwibWF0IiwidGV4dHVyZXMuYmFyayIsInRleHR1cmVzLmxlYXZlcyJdLCJtYXBwaW5ncyI6Inl3QkFBZSxNQUFNQSxDQUFJLENBS3ZCLFlBQVlDLEVBQU0sQ0FKbEJDLEVBQUEsV0FBTSxXQUNOQSxFQUFBLFdBQU0sV0FDTkEsRUFBQSxZQUFPLFlBR0wsS0FBSyxJQUFPLFVBQVlELEVBQVEsS0FBSyxLQUNyQyxLQUFLLElBQU8sVUFBWUEsRUFBUSxLQUFLLElBQ3RDLENBS0QsT0FBT0UsRUFBTSxFQUFHQyxFQUFNLEVBQUcsQ0FDdkIsS0FBSyxJQUFPLE9BQVMsS0FBSyxJQUFNLFFBQVUsS0FBSyxLQUFPLElBQU8sS0FBSyxLQUNsRSxLQUFLLElBQU8sTUFBUyxLQUFLLElBQU0sUUFBVSxLQUFLLEtBQU8sSUFBTyxLQUFLLEtBQ2xFLElBQUlDLEdBQVcsS0FBSyxLQUFPLEtBQU8sS0FBSyxJQUFNLFNBQVksRUFDekQsT0FBQUEsR0FBVSxZQUVGRixFQUFNQyxHQUFPQyxFQUFTRCxDQUMvQixDQUNILENDbkJPLE1BQU1FLENBQU8s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
